# Study-APS-Task3
Antida Python School. Итоговое задание по курсу. Учебный проект "Сервис для учета личных финансов".

## Формулировка задания

**Предметная область:** «Сервис для учета личных финансов»

<details>
  <summary>Словесное описание требований</summary>
  
  1. Сайт представляет собой сервис для учета личных финансов. Пользователи сервиса фиксируют свои доходы и расходы, чтобы видеть отчеты по своим личным финансам.
  2. Для работы на сайте необходима регистрация, обязательные поля профиля — имя, фамилия, email, пароль. Для авторизации используется пара email и пароль.
  3. Зарегистрированный пользователь может:
  
- Добавлять операции доходов и расходов, а также редактировать и удалять добавленные операции
- Добавлять категории для операций, а также редактировать и удалять существующие категории
- Строить отчеты с разрезами по временному периоду и категории

  4. При добавлении операции пользователь передает следующие поля:
  
- Тип операции (доход/расход)
- Сумма
- Описание операции (не обязательно)
- Категория (не обязательно, у операции может быть 1 или 0 категорий)
- Дата и время (не обязательно, по умолчанию используется текущее время)

  5. При добавлении категории пользователь передает следующие поля:
  
- Название
- Родительская категория (не обязательно, если не указана, то создается категория верхнего уровня)

  6. Категории могут вкладываться друг в друга, образуя древовидную структуру. Например: категория «Еда» может содержать подкатегории «Продукты», «Рестораны», «Обеды».
  7. При построении отчета об операциях, пользователь может указать категорию и временной период, по которым строится отчет:

- Если указана категория, то учитываются операции из категории и всех ее подкатегорий, подкатегорий ее подкатегорий и так далее. Если категория не указано, то в отчет включаются все операции за период независимо от категории
- Варианты временных периодов: текущая неделя (с понедельника по воскресенье), предыдущая неделя, текущий месяц, предыдущий месяц, текущий квартал, предыдущий квартал, текущий год, предыдущий год, произвольный диапазон (указываются даты начала и конца диапазона), всё время

  8. Отчет об операциях содержит:
- Список операций, соответствующий указанным категории и временному периоду. Для каждой операции отдается дата, сумма, описание и категория (вместе со всеми родительскими категориями). Список отсортирован по дате и отдается с пагинацией
- Общую сумма для всех операций из списка
</details>

**Описание API:**

<details>
  <summary>Авторизация пользователя. Вход и выход</summary>
  
  ```javascript
  POST /auth/login
  ```
  ```javascript
  Request:
  {
    "email": str,
    "password": str
  }
  ```
  ```javascript
  POST /auth/logout
  ```
</details>

<details>
  <summary>Регистрация пользователя</summary>
  
  Поле is_seller показывает, является ли пользователь продавцом. Поля phone, zip_code, city_id, street, home указываются, только если пользователь является продавцом.
  ```javascript
  POST /users
  ```
  ```javascript
  Request:
  {
    "email": str,
    "password": str,
    "first_name": str,
    "last_name": str,
    "is_seller": bool,
    "phone": str?,
    "zip_code": int?,
    "city_id": int?,
    "street": str?,
    "home": str?
  }
  Response:
  {
    "id": int,
    "email": str,
    "first_name": str,
    "last_name": str,
    "is_seller": bool,
    "phone": str?,
    "zip_code": int?,
    "city_id": int?,
    "street": str?,
    "home": str?
  }
  ```
</details>

<details>
  <summary>Получение пользователя</summary>
  Доступно только авторизованным пользователям.
  
  ```javascript
  GET /users/<id>
  ```
  ```javascript
  Response:
  {
    "id": int,
    "email": str,
    "first_name": str,
    "last_name": str,
    "is_seller": bool,
    "phone": str?,
    "zip_code": int?,
    "city_id": int?,
    "street": str?,
    "home": str?
  }
  ```
</details>

<details>
  <summary>Частичное редактирование пользователя</summary>
  Доступно только текущему авторизованному пользователю. Поля phone, zip_code, city_id, street, home указываются, только если пользователь является продавцом. При установке флага is_seller в false должно происходить удаление сущностей продавца.
  
  ```javascript
  PATCH /users/<id>
  ```
  ```javascript
  Request:
  {
    "first_name": str?,
    "last_name": str?,
    "is_seller": bool?,
    "phone": str?,
    "zip_code": int?,
    "city_id": int?,
    "street": str?,
    "home": str?
  }
  Response:
  {
    "id": int,
    "email": str,
    "first_name": str,
    "last_name": str,
    "is_seller": bool,
    "phone": str?,
    "zip_code": int?,
    "city_id": int?,
    "street": str?,
    "home": str?
  }
  ```
</details>

<details>
  <summary>Получение списка объявлений</summary>
  Объявления: все и принадлежащих пользователю. Список можно фильтровать с помощью query string параметров, все параметры необязательные.
  
  ```javascript
  GET /ads
  ```
  ```javascript
  GET /users/<id>/ads
  Query string:
    seller_id: int?
    tags: str?
    make: str?
    model: str?
  Response:
  [
    {
      "id": int,
      "seller_id": int,
      "title": str,
      "date": str,
      "tags:": [str], // Список тегов строками
      "car": {
        "make": str,
        "model": str,
        "colors": [
          {
            "id": int,
            "name": str,
            "hex": str
          }
        ],
        "mileage": int,
        "num_owners": int,
        "reg_number": str,
        "images": [
          {
            "title": str,
            "url": str
          }
        ]
      }
    }
  ]
  ```
</details>

## Краткое описание

Проект представляет собой приложение, написанное на языке Python с применением web-фреймворка Flask.
Реализован REST API, обеспечивающий требуемые методы (см. раздел "Формулировка задания")

## Актуальная версия

 - Версия: [v0.0.1](https://github.com/jasper7466/Study-APS-Task3/tree/v0.0.1)


## Как развернуть проект

Для запуска приложения, в системе должен быть установлен интерпретатор [Python](https://www.python.org/downloads/) версии 3.8 или новее. Совместимость с более ранними версиями не гарантируется.

### 1. Виртуальное окружение *(опционально)*
Разработку рекомендуется вести в изолированном режиме из под виртуального окружения. Для его установки потребуется установить пакет [virtualenv](https://pypi.org/project/virtualenv/):

`$ pip install virtualenv`

### 2. Клонирование проекта
Чтобы клонировать проект локально - вызовите интерфейс командной строки (например, [Git Bash](https://gitforwindows.org)) в желаемой директории, выполните команду:

`$ git clone https://github.com/jasper7466/Study-APS-Task3.git`

и перейдите в директорию проекта:

`$ cd ./Study-APS-Task3`

### 3. Установка виртуального окружения *(опционально)*

`$ python -m virtualenv venv`

### 4. Активация виртуального окружения *(опционально)*

`$ . venv/Scripts/activate`

### 5. Установка пакетов из зависимостей
Зависимости зафиксированы в файле `requirements.txt`. Для их автоматической установки достаточно выполнить команду:

`$ pip install -r requirements.txt`

*Примечание: если работа ведётся не из под venv - пакеты установятся в систему*

### 6. Установка переменных окружения
Добавление в PYTHONPATH пути до корня приложения (где лежит модуль app.py):

`$ export PYTHONPATH=./src` (или `set PYTHONPATH=./src`)

Установка пути до приложения относительно PYTHONPATH в переменную окружения FLASK_APP:

`$ export FLASK_APP=app:create_app` (или `set FLASK_APP=app:create_app`)

Для запуска в режиме отладки следует устанавить переменную окружения FLASK_ENV в значение "development":

`$ export FLASK_ENV=development` (или `set FLASK_ENV=development`)

При такой настройке:
- сервер будет запущен в режиме автоматической "горячей" перезагрузки приложения при детектировании изменений в его исходных кодах
- при возникновении ошибок в браузере будет выводиться stack trace

Установку переменных окружения и некоторых других переменных параметров при каждом запуске приложения можно избежать, добавив в корневую директорию проекта файлы `.env` и `.flaskenv` следующего содержания:

*.env:*
```
DB_CONNECTION = example.db
SECRET_KEY = secret_key
```

*.flaskenv:*
```
PYTHONPATH = ./src
FLASK_APP = app:create_app
FLASK_ENV = development
```

Указанные в этих файлах параметры будут автоматически подтягиваться и применяться с помощью пакета [python-dotenv](https://pypi.org/project/python-dotenv/)

### 7. Запуск приложения
Для запуска приложения в настроенном на предыдущем шаге режиме выполните команду:

`$ flask run`

### 8. Фиксирование зависимостей
После завершения доработки проекта, в случае добавления новых пакетов - следует зафиксировать зависимости, обновив файл `requirements.txt`. Это можно сделать автоматически, выполнив команду:

`$ pip freeze > requirements.txt`

Команду имеет смысл выполнять из под виртуального окружения, если оно используется. В противном случае будут подтянуты все локальные пакеты из системы.

## Примечания

- Файл БД не исключён из индекса и присутствует в репозитории для удобства продолжения тестирования/доработки. При отладке желательно скопировать его вне директории проекта, изменив соответствующим образом переменную `DB_CONNECTION ` в файле `.env`, либо добавить в `.gitignore`.

## Технологии

 - Python
 - Flask
 - HTTP
 - REST API
 - Sqlite

## Известные проблемы и что можно улучшить

- Валидация структуры запросов выполнена частично
- Валидация передаваемых данных отстутсвует
- Код не покрыт автоматическими тестами